# 今だからこそ作る、Laravelで「アクセスカウンター」

![Counter](/counter?w=300&h=40)人の方が、このスライドを見ています



## Who am I ?

* Kazuya Takei
* NIJIBOX Co., Ltd.



## アクセスカウンター


### どんなものだっけ？

* ホームページにアクセスしたときに出てくる、「何人目に訪れたか」がわかるカウンター
  * サイトの人気具合を図る「スカウター」の一種
  * たまに壊れる
  * 「キリ番」「踏み逃げ」という文化
* アクセス解析の機能がついていたりも


### ぶっちゃけ

**「旧世代の風物詩」感ありますね** (要出展)

### ちなみに...

「忍者カウンター」サービスはいまだ現役でした

https://www.ninja.co.jp/



## 技術的な視点で見るアクセスカウンター

### 仕組みを分解してみる

リクエストに応じて、

* 永続化されたデータストアに対して、加算を行い
* その数値とベースの絵素材から、表示用画像を作り
* 画像としてレスポンスを返す


### 仕組みを分解してみる(2)

さらにおまけで、

* リクエストヘッダなどを元に、人を分類
  * 新規の来訪者
  * 直近の再来訪者
  * 時間経過してかららから来た人
* 直近の再来訪者だったらカウンターの加算をせずに画像を表示
  * 場合によっては304レスポンスも？


### まとめると
* セッション情報を元にしたキャッシュ出し分けを行い
* 多重アクセスしてもある程度正しく処理できるように、排他処理でカウンターを扱い
* 画像を結合して、 ``image/xxx`` レスポンスを返す
* さらに、Webサービスとして提供するのなら管理画面なども必要

...コンパクトなWebアプリってこういうことを言うのかも



## Laravelで作る！
